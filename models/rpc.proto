syntax = "proto3";

import "gogoproto/gogo.proto";
import "agro.proto";

package models;

service AgroStorage {
	rpc Block (BlockRequest) returns (BlockResponse);
	rpc INode (INodeRequest) returns (INodeResponse);
	rpc PutBlock (PutBlockRequest) returns (PutResponse);
	rpc PutINode (PutINodeRequest) returns (PutResponse);
}

message BlockRef {
	uint64 volume = 1;
	uint64 inode = 2 [(gogoproto.customname) = "INode"];
	uint64 block = 3;
}

message INodeRef {
	uint64 volume = 1;
	uint64 inode = 2 [(gogoproto.customname) = "INode"];
}

message Block {
	bool ok = 1;
	bytes data = 2;
}

message BlockRequest {
	repeated BlockRef blockrefs = 1;
}

message BlockResponse {
	repeated Block blocks = 1;
}

message INodeRequest {
	repeated INodeRef inoderefs = 1;
}

message INodeResponse {
	repeated INode inodes = 2 [(gogoproto.customname) = "INodes"];
}

message PutBlockRequest {
	uint32 replication_factor = 1;
	repeated BlockRef refs = 2;
	repeated bytes blocks = 3;
}

message PutINodeRequest {
	uint32 replication_factor = 1;
	repeated INodeRef refs = 2;
	repeated INode inodes = 3 [(gogoproto.customname) = "INodes"];
}

message PutResponse {
	bool ok = 1;
	string err = 2;
}

